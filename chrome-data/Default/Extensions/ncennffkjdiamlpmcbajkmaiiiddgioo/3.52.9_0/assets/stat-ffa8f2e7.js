import{k as e,W as t,I as n,l as r,X as o,T as i,i as s}from"./util-1fabc922.js";function a(e){for(const n in t){const r=new RegExp(t[n],"i").exec(e);if(null!=r)return r}return null}function c(e){const t=e.toLowerCase();let n=!0;return-1!=t.indexOf("?")&&-1==t.indexOf("magnet:?")||(n=!1),n}function d(e){const t=e.replace(/(\\+)/g,"#").split("#"),n=t[t.length-1].split(".");return n[n.length-1]}function u(e,t){let n=!1;do{if(!t)break;const r=t.getBoundingClientRect();if(e.clientX<r.left||e.clientY<r.top||e.clientX>r.right||e.clientY>r.bottom)break;n=!0}while(0);return n}function f(){const t=new Set,n=document.getElementsByTagName("body");if(0!==n.length){for(const r of n){const n=r.innerHTML.match(e);n&&n.forEach(e=>{t.add(e)})}return t}}function l(e,t){if(0==e.length)return!1;if(0==t.length)return!1;const n=[],r=t.split("||");for(const s in r){const e=r[s].slice(2).toLowerCase().trimRight("|");n.push(e)}let o=!1;const i=e.toLowerCase();for(const s in n)if(n[s]>0&&-1!=i.indexOf(n[s])){o=!0;break}return o}function p(){let e=!1;do{if(!document.activeElement)break;const t=document.activeElement,n=t.tagName.toUpperCase();if("INPUT"===n||"TEXTAREA"===n){e=!0;break}if(!t.contentEditable)break;if("true"===t.contentEditable.toLowerCase()){e=!0;break}}while(0);return e}function h(e,t){let n=void 0;do{if(!e)break;if("VIDEO"!==e.tagName.toUpperCase())break;if(e.src){if(0===e.src.toLowerCase().indexOf("blob:")&&!t)break;n=e.src;break}if(!e.children||0===e.children.length)break;for(let t=0;t<e.children.length;t++){const r=e.children[t];if("source"===r.tagName.toLowerCase()&&r.src){0!==r.src.toLowerCase().indexOf("blob:")&&(n=r.src);break}}}while(0);return n}let b=void 0;const g=function(e){const{aid:t,id:o,ext:i,thunderVersion:a,peerId:c,osVersion:d,parentProcess:u,currentTab:f={}}=e;let l="http://stat.download.xunlei.com:8099/?xlbtid=1&aid="+t+"&id="+o+"&peerid="+c+`&userid=&referfrom=100001&OS=${s?"Mac OS":"win"}&OSversion=`+d+"&productname=ThunderX&productversion="+a+"&value3="+b+"&value4="+u+"&valueT="+(new Date).getTime();i&&i.length>0&&(l+="&"+i),r.info("report stat",`aid: ${t} id: ${o} thunderVersion: ${a} peerId: ${c} osVersion: ${d} parentProcess: ${u} `,"业务参数:",i),n({url:l,type:"GET",success:function(){},error:function(e){r.error("report stat failed !!!",e)}})},m=function(e,t,n){o.postMessage("GetThunderInfo",[],void 0,(async function(r,o){if(r){const r=o[0].peerId,i=o[0].osVersion,s=o[0].thunderVersion,a=o[0].parentProcess;g({aid:e,id:t,ext:n,thunderVersion:s,peerId:r,osVersion:i,parentProcess:a})}else{const r=await i("Q");g({aid:e,id:t,ext:n,thunderVersion:"",peerId:r,osVersion:"",parentProcess:""})}}))};function k(e,t,o){b?m(e,t,o):n({url:chrome.runtime.getURL("manifest.json"),type:"GET",success:function(n){b=n.version,m(e,t,o)},error:function(e){r.error("stat failed! error 2:",e)}})}function w(e,t,n={}){r.info("report stat v2",`aid: ${e} id: ${t} `,n&&JSON.stringify(n)),k(e,t,function(e,t="&"){return 0===Object.keys(e).length?"":Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join(t)}(n))}export{d as G,c as I,u as a,f as b,a as c,l as d,w as e,h as g,p as i,k as s};
